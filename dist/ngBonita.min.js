"use strict";angular.module("ngBonita",["ngResource"]),angular.module("ngBonita").factory("bonitaAuthentication",["$log","$http","$q","BonitaSession","bonitaConfig","bonitaUtils",function(a,b,c,d,e,f){var g={};return g.login=function(h,i){var j=c.defer();return g.isLogged=!1,b({method:"POST",url:e.getBonitaUrl()+"/loginservice",data:f.serializeData({username:h,password:i,redirect:!1}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(){a.log("BonitaAuthentication.login success"),d.getCurrent().$promise.then(function(a){"undefined"==typeof a.user_id?j.reject("No active session found"):(e.setUsername(a.user_name),e.setUserId(a.user_id),g.isLogged=!0,j.resolve(a))})}).error(function(b,c,d,f){a.log("BonitaAuthentication.login failure response "+c),a.log("Bonita URL: "+e.getBonitaUrl()),g.isLogged=!1,j.reject({data:b,status:c,headers:d,config:f})}),j.promise},g.checkForActiveSession=function(){var a=c.defer();return d.getCurrent().$promise.then(function(b){"undefined"==typeof b.user_id?g.isLogged=!1:(e.setUsername(b.user_name),e.setUserId(b.user_id),g.isLogged=!0),a.resolve(b)}),a.promise},g.logout=function(){var d=c.defer();return b({method:"GET",url:e.getBonitaUrl()+"/logoutservice",data:f.serializeData({redirect:!1}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}}).success(function(){a.log("BonitaAuthentication.logout success"),e.setUsername(null),e.setUserId(null),g.isLogged=!1,d.resolve()}).error(function(b,c,e,f){a.log("BonitaAuthentication.logout failure response "+c),g.isLogged=!1,d.reject({data:b,status:c,headers:e,config:f})}),d.promise},g}]),angular.module("ngBonita").provider("bonitaConfig",function(){var a="http://localhost:8080/bonita",b={p:0,c:10},c=null,d=null;this.setBonitaUrl=function(b){a=b},this.overrideDefaultPagerValues=function(a){angular.extend(b,a)},this.$get=function(){var e={};return e.getBonitaUrl=function(){return a},e.getUserId=function(){return c},e.setUserId=function(a){c=a},e.getUsername=function(){return d},e.setUsername=function(a){d=a},e.getDefaultPager=function(){return b},e}}),angular.module("ngBonita").factory("bonitaUtils",["$http","bonitaConfig",function(a,b){var c={},d=function(a,c){var d=c()["content-range"],e=d?d.split("/"):[b.getDefaultPager().p+"-"+b.getDefaultPager().c],f=e[0].split("-");return{items:angular.fromJson(a),pageIndex:Number(f[0]),pageSize:Number(f[1]),totalCount:Number(e[1])}};return c.transformPaginateResponse=function(){return[d].concat(a.defaults.transformResponse)},c.serializeData=function(a){if(!angular.isObject(a))return null===a?"":a.toString();var b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(encodeURIComponent(c)+"="+encodeURIComponent(null===d?"":d))}var e=b.join("&").replace(/%20/g,"+");return e},c}]),angular.module("ngBonita").factory("ArchivedCaseDocument",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/archivedCaseDocument/:id",d,{getUploadedByCurrentUser:{method:"GET",params:{f:function(){return["submittedBy="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()},search:{method:"GET",transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("ArchivedHumanTask",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id",o:"reached_state_date ASC"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/archivedHumanTask/:id",d,{getCompletedByCurrentUser:{method:"GET",params:{f:function(){return["assigned_id="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("ArchivedProcessInstance",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/archivedCase/:id",d,{getStartedByCurrentUser:{method:"GET",params:{f:function(){return["started_by="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("BonitaSession",["$resource","bonitaConfig",function(a,b){return a(b.getBonitaUrl()+"/API/system/session/unused",{},{getCurrent:{method:"GET"}})}]),angular.module("ngBonita").factory("BusinessData",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({businessDataType:"@businessDataType",q:"@queryName",f:"@fields",persistanceId:"@persistenceId"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bdm/businessData/:businessDataType/:persistenceId",d,{getDataQuery:{method:"GET",params:{q:function(){return d.q},f:function(){return d.f}},transformResponse:c.transformPaginateResponse()},getBusinessData:{method:"GET"}})}]),angular.module("ngBonita").factory("CaseDocument",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/caseDocument/:id",d,{getUploadedByCurrentUser:{method:"GET",params:{f:function(){return["submittedBy="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()},search:{method:"GET",transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("HumanTask",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id",o:"priority ASC"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/humanTask/:id",d,{getFromCurrentUser:{method:"GET",params:{f:function(){return["state=ready","user_id="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("ProcessDefinition",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id",o:"displayName ASC"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/process/:id",d,{getStartableByCurrentUser:{method:"GET",params:{f:function(){return["user_id="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("ProcessInstance",["$resource","bonitaConfig","bonitaUtils",function(a,b,c){var d=angular.extend({id:"@id"},b.getDefaultPager());return a(b.getBonitaUrl()+"/API/bpm/case/:id",d,{getStartedByCurrentUser:{method:"GET",params:{f:function(){return["started_by="+b.getUserId()]}},transformResponse:c.transformPaginateResponse()}})}]),angular.module("ngBonita").factory("User",["$resource","bonitaConfig",function(a,b){return a(b.getBonitaUrl()+"/API/identity/user/:id",{id:"@id"})}]);